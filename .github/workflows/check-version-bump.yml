name: Version Bump Check
on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  check-version:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get PR version
        id: pr
        run: echo "version=$(jq -r .version package.json)" >> "$GITHUB_OUTPUT"

      - name: Get base version
        id: base
        run: |
          git checkout ${{ github.event.pull_request.base.sha }} -- package.json
          echo "version=$(jq -r .version package.json)" >> "$GITHUB_OUTPUT"
          git checkout HEAD -- package.json

      - name: Compare versions
        run: |
          if [ "${{ steps.pr.outputs.version }}" = "${{ steps.base.outputs.version }}" ]; then
            echo "::error::Version in package.json has not been bumped. Run 'npm run release -- patch|minor|major' before pushing."
            exit 1
          fi
          echo "Version bumped: ${{ steps.base.outputs.version }} â†’ ${{ steps.pr.outputs.version }}"
