---
phase: 02-blog-project-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/00002_blog_projects.sql
  - src/main.tsx
  - src/routes/__root.tsx
  - src/components/ui/dialog.tsx
  - src/components/ui/input.tsx
  - src/components/ui/label.tsx
  - src/components/ui/card.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "blog_projects table exists in Supabase with RLS policies enforcing tenant isolation"
    - "QueryClientProvider wraps the app so TanStack Query hooks can be used anywhere"
    - "Toaster component renders so toast notifications work globally"
    - "shadcn/ui Dialog, Input, Label, and Card components are available for import"
  artifacts:
    - path: "supabase/migrations/00002_blog_projects.sql"
      provides: "blog_projects table with RLS"
      contains: "CREATE TABLE"
    - path: "src/main.tsx"
      provides: "QueryClientProvider wrapping RouterProvider"
      contains: "QueryClientProvider"
    - path: "src/components/ui/dialog.tsx"
      provides: "Dialog component"
      contains: "Dialog"
    - path: "src/components/ui/card.tsx"
      provides: "Card component"
      contains: "Card"
  key_links:
    - from: "src/main.tsx"
      to: "@tanstack/react-query"
      via: "QueryClientProvider"
      pattern: "QueryClientProvider"
    - from: "src/routes/__root.tsx"
      to: "sonner"
      via: "Toaster component"
      pattern: "Toaster"
---

<objective>
Set up the foundation for Phase 2: database schema for blog_projects, install form validation libraries, add shadcn/ui components (Dialog, Input, Label, Card), and wire up QueryClientProvider + Toaster at the app root.

Purpose: All subsequent Phase 2 plans depend on these foundations — the database table, UI primitives, and React Query context must exist first.
Output: Migration SQL, installed npm packages, shadcn/ui components, QueryClientProvider + Toaster wired into app root.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@supabase/migrations/00001_initial_schema.sql
@src/main.tsx
@src/routes/__root.tsx
@src/components/ui/button.tsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create blog_projects database migration and install form libraries</name>
  <files>
    supabase/migrations/00002_blog_projects.sql
    package.json
  </files>
  <action>
    1. Create `supabase/migrations/00002_blog_projects.sql` with:
       - `blog_projects` table with columns:
         - `id UUID PRIMARY KEY DEFAULT gen_random_uuid()`
         - `tenant_id UUID NOT NULL REFERENCES profiles(tenant_id) ON DELETE CASCADE`
         - `name TEXT NOT NULL`
         - `blog_url TEXT NOT NULL`
         - `rss_url TEXT` (nullable, optional)
         - `scraping_frequency TEXT DEFAULT 'weekly' CHECK (scraping_frequency IN ('daily', 'weekly', 'manual'))`
         - `description TEXT` (nullable, optional)
         - `created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()`
         - `updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()`
       - Enable RLS: `ALTER TABLE public.blog_projects ENABLE ROW LEVEL SECURITY;`
       - Performance index: `CREATE INDEX IF NOT EXISTS idx_blog_projects_tenant_id ON public.blog_projects(tenant_id);`
       - Four RLS policies (SELECT, INSERT, UPDATE, DELETE) matching Phase 1 tenant isolation pattern:
         ```sql
         tenant_id IN (
           SELECT tenant_id FROM public.profiles WHERE id = (SELECT auth.uid())
         )
         ```
       - Auto-update trigger using existing `handle_updated_at()` function from 00001 migration

    2. Install form validation libraries:
       ```bash
       npm install react-hook-form zod @hookform/resolvers
       ```

    3. Apply the migration to Supabase using the Supabase MCP tool `execute_sql` — read the SQL file and execute it against the project.
  </action>
  <verify>
    - File `supabase/migrations/00002_blog_projects.sql` exists and contains CREATE TABLE, ENABLE ROW LEVEL SECURITY, 4 CREATE POLICY statements, and CREATE TRIGGER
    - `npm ls react-hook-form zod @hookform/resolvers` shows all three installed
    - Migration applied successfully (no SQL errors from Supabase)
  </verify>
  <done>blog_projects table exists with RLS policies and tenant isolation. react-hook-form, zod, and @hookform/resolvers installed.</done>
</task>

<task type="auto">
  <name>Task 2: Add shadcn/ui components and wire QueryClientProvider + Toaster</name>
  <files>
    src/components/ui/dialog.tsx
    src/components/ui/input.tsx
    src/components/ui/label.tsx
    src/components/ui/card.tsx
    src/main.tsx
    src/routes/__root.tsx
  </files>
  <action>
    1. Add shadcn/ui components using the shadcn CLI:
       ```bash
       npx shadcn@latest add dialog input label card
       ```
       If the CLI prompts for configuration, accept defaults. The components should land in `src/components/ui/`.
       If the CLI fails or doesn't work with this project setup, manually create the components following shadcn/ui source patterns with Tailwind v4 classes and the existing `cn()` utility from `@/lib/utils`.

    2. Update `src/main.tsx` to wrap the app with `QueryClientProvider`:
       - Import `QueryClient` and `QueryClientProvider` from `@tanstack/react-query`
       - Create a `QueryClient` instance with `defaultOptions.queries.staleTime: 30000` (30s)
       - Wrap `<RouterProvider>` inside `<QueryClientProvider client={queryClient}>`

    3. Update `src/routes/__root.tsx` to include the `<Toaster />` component:
       - Import `Toaster` from `sonner`
       - Add `<Toaster richColors position="top-right" />` alongside the existing `<Outlet />` (wrap both in a Fragment if needed)
       - This enables toast notifications globally for all routes
  </action>
  <verify>
    - Files exist: `src/components/ui/dialog.tsx`, `src/components/ui/input.tsx`, `src/components/ui/label.tsx`, `src/components/ui/card.tsx`
    - `src/main.tsx` contains `QueryClientProvider` wrapping `RouterProvider`
    - `src/routes/__root.tsx` contains `<Toaster` from sonner
    - `npm run build` completes without TypeScript errors
  </verify>
  <done>shadcn/ui Dialog, Input, Label, Card components available. QueryClientProvider wraps app. Toaster renders globally.</done>
</task>

</tasks>

<verification>
- `supabase/migrations/00002_blog_projects.sql` has correct schema, RLS policies, and trigger
- `npm ls react-hook-form zod @hookform/resolvers` all installed
- shadcn/ui components exist in `src/components/ui/`
- `src/main.tsx` has QueryClientProvider
- `src/routes/__root.tsx` has Toaster
- `npm run build` succeeds
</verification>

<success_criteria>
- blog_projects table created in Supabase with RLS enforcing tenant isolation
- Form libraries installed (react-hook-form, zod, @hookform/resolvers)
- shadcn/ui Dialog, Input, Label, Card components available
- TanStack Query context provided at app root
- Toast notifications functional globally
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-blog-project-management/02-01-SUMMARY.md`
</output>
