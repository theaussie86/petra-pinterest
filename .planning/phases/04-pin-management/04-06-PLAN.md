---
phase: 04-pin-management
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/pins/pins-list.tsx
  - src/styles.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Bulk delete in pins list shows a proper Dialog confirmation (not browser alert)"
    - "Single delete from dropdown in pins list shows a proper Dialog confirmation (not browser alert)"
    - "Dropdown menus and select popovers render with a solid white background"
  artifacts:
    - path: "src/components/pins/pins-list.tsx"
      provides: "Dialog-based delete confirmations replacing window.confirm()"
      contains: "Dialog"
    - path: "src/styles.css"
      provides: "CSS custom properties for popover background"
      contains: "--color-popover"
  key_links:
    - from: "src/components/pins/pins-list.tsx"
      to: "@/components/ui/dialog"
      via: "import Dialog, DialogContent, etc."
      pattern: "import.*Dialog.*from.*ui/dialog"
    - from: "src/styles.css"
      to: "src/components/ui/dropdown-menu.tsx"
      via: "CSS custom property --color-popover consumed by bg-popover utility"
      pattern: "--color-popover"
---

<objective>
Close 2 UAT gaps from Phase 4 Pin Management:

1. Replace `window.confirm()` calls in pins-list.tsx with proper shadcn Dialog-based confirmations for both bulk delete and single delete from the dropdown menu.
2. Add missing `--color-popover` and `--color-popover-foreground` CSS custom properties so dropdown/select components render with solid backgrounds instead of transparent.

Purpose: Polish the pin management UI to use consistent confirmation dialogs and fix visual rendering of all popover-based components.
Output: Updated pins-list.tsx with inline Dialog confirmations and updated styles.css with popover CSS variables.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-pin-management/04-UAT.md

@src/components/pins/pins-list.tsx
@src/components/pins/delete-pin-dialog.tsx
@src/components/ui/dialog.tsx
@src/components/ui/dropdown-menu.tsx
@src/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace window.confirm() with Dialog confirmations in pins-list.tsx</name>
  <files>src/components/pins/pins-list.tsx</files>
  <action>
Replace both `window.confirm()` calls in `pins-list.tsx` with proper Dialog-based confirmations using the existing Dialog component from `@/components/ui/dialog`. Do NOT use AlertDialog (not installed in the project).

Follow the pattern already established in `src/components/pins/delete-pin-dialog.tsx` which uses `Dialog`, `DialogContent`, `DialogHeader`, `DialogTitle`, `DialogDescription`, `DialogFooter`, and `Button`.

Specific changes:

1. Add imports from `@/components/ui/dialog`: Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter.

2. Add two new state variables:
   - `const [bulkDeleteOpen, setBulkDeleteOpen] = useState(false)` — controls bulk delete confirmation dialog
   - `const [singleDeleteTarget, setSingleDeleteTarget] = useState<string | null>(null)` — holds pin id for single delete; when non-null, dialog is open

3. Replace `handleBulkDelete` (lines 148-155):
   - Remove `window.confirm()` call entirely
   - Change to: `setBulkDeleteOpen(true)` to open the dialog
   - Create a new `confirmBulkDelete` async function that does the actual delete:
     ```
     await bulkDeleteMutation.mutateAsync(Array.from(selectedIds))
     clearSelection()
     setBulkDeleteOpen(false)
     ```

4. Replace `handleDeletePin` (lines 166-174):
   - Remove `window.confirm()` call entirely
   - Change to: `setSingleDeleteTarget(id)` to open the dialog
   - Create a new `confirmSingleDelete` async function:
     ```
     if (!singleDeleteTarget) return
     await deletePinMutation.mutateAsync(singleDeleteTarget)
     setSelectedIds(prev => { const next = new Set(prev); next.delete(singleDeleteTarget); return next })
     setSingleDeleteTarget(null)
     ```

5. Add two Dialog components at the end of the return JSX (inside the outer `<div className="space-y-4">`), after the closing `</Tabs>`:

   Bulk delete dialog:
   ```jsx
   <Dialog open={bulkDeleteOpen} onOpenChange={setBulkDeleteOpen}>
     <DialogContent>
       <DialogHeader>
         <DialogTitle>Delete {selectedIds.size} Pin{selectedIds.size > 1 ? 's' : ''}</DialogTitle>
         <DialogDescription>
           Are you sure you want to delete {selectedIds.size} selected pin{selectedIds.size > 1 ? 's' : ''}? The associated images will also be removed from storage. This action cannot be undone.
         </DialogDescription>
       </DialogHeader>
       <DialogFooter>
         <Button variant="outline" onClick={() => setBulkDeleteOpen(false)} disabled={bulkDeleteMutation.isPending}>
           Cancel
         </Button>
         <Button variant="destructive" onClick={confirmBulkDelete} disabled={bulkDeleteMutation.isPending}>
           {bulkDeleteMutation.isPending ? 'Deleting...' : 'Delete'}
         </Button>
       </DialogFooter>
     </DialogContent>
   </Dialog>
   ```

   Single delete dialog:
   ```jsx
   <Dialog open={singleDeleteTarget !== null} onOpenChange={(open) => { if (!open) setSingleDeleteTarget(null) }}>
     <DialogContent>
       <DialogHeader>
         <DialogTitle>Delete Pin</DialogTitle>
         <DialogDescription>
           Are you sure you want to delete this pin? The associated image will also be removed from storage. This action cannot be undone.
         </DialogDescription>
       </DialogHeader>
       <DialogFooter>
         <Button variant="outline" onClick={() => setSingleDeleteTarget(null)} disabled={deletePinMutation.isPending}>
           Cancel
         </Button>
         <Button variant="destructive" onClick={confirmSingleDelete} disabled={deletePinMutation.isPending}>
           {deletePinMutation.isPending ? 'Deleting...' : 'Delete'}
         </Button>
       </DialogFooter>
     </DialogContent>
   </Dialog>
   ```

6. Update the bulk delete button's `onClick` to call the new `handleBulkDelete` (which now just opens the dialog).

7. Update the dropdown delete menu item's `onClick` to call `handleDeletePin(pin.id)` (which now just sets the target).

Do NOT install any new packages. Do NOT modify the DeletePinDialog component (it's used separately on the pin detail page and is fine as-is).
  </action>
  <verify>
Run `npm run build` to confirm no TypeScript errors. Visually confirm in the browser: select pins and click bulk delete - a styled dialog appears with Cancel/Delete buttons. Click Delete in a row's dropdown menu - a styled dialog appears. Both dialogs should match the visual style of the existing DeletePinDialog on the pin detail page.
  </verify>
  <done>
Both bulk delete and single delete from the pins list show proper Dialog confirmations instead of browser `window.confirm()`. No `window.confirm` calls remain in pins-list.tsx. Dialogs show pending state during deletion. Cancel closes without action.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add missing popover CSS custom properties for solid backgrounds</name>
  <files>src/styles.css</files>
  <action>
Add the missing `--color-popover` and `--color-popover-foreground` CSS custom properties to the `@theme` block in `src/styles.css`.

The existing `@theme` block defines colors like `--color-background: #ffffff` and `--color-foreground: #0a0a0a`. The shadcn components (`dropdown-menu.tsx`, `select.tsx`) use `bg-popover` and `text-popover-foreground` Tailwind classes, which map to `--color-popover` and `--color-popover-foreground` CSS custom properties. These are currently undefined, causing transparent backgrounds on all dropdown menus and select popovers.

Add these two lines inside the existing `@theme { ... }` block, after `--color-destructive-foreground`:

```css
--color-popover: #ffffff;
--color-popover-foreground: #0a0a0a;
```

These match the existing `--color-background` and `--color-foreground` values, which is the standard shadcn pattern for popover colors (popovers should have the same base colors as the page background).

Also add these related missing variables that other shadcn components may rely on (following the same convention as the existing theme):

```css
--color-card: #ffffff;
--color-card-foreground: #0a0a0a;
--color-input: #e5e5e5;
--color-ring: #e60023;
```

These ensure `bg-card`, `text-card-foreground`, `border-input`, and `ring-ring` all resolve correctly. The `--color-input` matches `--color-border` (input borders same as general borders), and `--color-ring` matches `--color-primary` (focus rings use primary color, which is Pinterest red).

Do NOT change any existing values. Do NOT modify component files. This is purely a CSS variable definition fix.
  </action>
  <verify>
Run `npm run build` to confirm no build errors. In the browser, open any dropdown menu (e.g., the sort dropdown on the pins list, or the row action "..." menu). The dropdown should have a solid white background with proper shadows, not a transparent background showing content behind it.
  </verify>
  <done>
All dropdown menus and select popovers render with a solid white background. The `--color-popover` and `--color-popover-foreground` CSS custom properties are defined in `src/styles.css`. Additional missing shadcn theme variables (card, input, ring) are also defined.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. No `window.confirm` calls remain in `src/components/pins/pins-list.tsx`
3. Bulk delete from pins list opens a styled Dialog with Cancel and Delete buttons
4. Single pin delete from the row dropdown opens a styled Dialog with Cancel and Delete buttons
5. Both delete dialogs show "Deleting..." state while mutation is pending
6. All dropdown menus (sort, bulk status, row actions) have solid white backgrounds
7. All select popovers (e.g., in edit pin dialog) have solid white backgrounds
</verification>

<success_criteria>
- Zero `window.confirm()` calls in pins-list.tsx
- Both delete flows use Dialog component with proper cancel/confirm buttons
- `--color-popover` defined as `#ffffff` in styles.css @theme block
- `--color-popover-foreground` defined as `#0a0a0a` in styles.css @theme block
- `npm run build` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/04-pin-management/04-06-SUMMARY.md`
</output>
