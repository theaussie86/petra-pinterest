---
phase: 04-pin-management
plan: 04
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - src/components/pins/pins-list.tsx
  - src/components/pins/pin-card.tsx
  - src/components/pins/pin-status-badge.tsx
  - src/components/ui/checkbox.tsx
autonomous: true

must_haves:
  truths:
    - "User can view pins in table view (default) showing image thumbnail, title, article, status, date"
    - "User can view pins in grid view showing image cards with status overlay"
    - "User can toggle between table and grid views"
    - "User can filter pins by status using tabs (All, Entwurf, Bereit, Fehler)"
    - "User can select pins with checkboxes for bulk actions"
    - "User can bulk delete selected pins"
    - "User can bulk change status of selected pins"
    - "User can sort pins by column (client-side)"
  artifacts:
    - path: "src/components/pins/pins-list.tsx"
      provides: "Main pins list with table/grid toggle, status tabs, bulk actions bar"
      min_lines: 150
    - path: "src/components/pins/pin-card.tsx"
      provides: "Grid view card component for individual pin"
      min_lines: 30
    - path: "src/components/pins/pin-status-badge.tsx"
      provides: "Reusable status badge with correct colors"
      min_lines: 15
    - path: "src/components/ui/checkbox.tsx"
      provides: "shadcn/ui Checkbox primitive for selection"
  key_links:
    - from: "src/components/pins/pins-list.tsx"
      to: "src/lib/hooks/use-pins.ts"
      via: "usePins, useBulkDeletePins, useBulkUpdatePinStatus hooks"
    - from: "src/components/pins/pin-status-badge.tsx"
      to: "src/types/pins.ts"
      via: "PIN_STATUS constants and getStatusBadgeClasses helper"
    - from: "src/components/pins/pins-list.tsx"
      to: "src/lib/api/pins.ts"
      via: "getPinImageUrl for thumbnail rendering"
---

<objective>
Build the pins list component with dual view modes (table/grid), status filter tabs, client-side sorting, checkbox selection, and bulk action bar (delete, status change). This is the primary view for browsing and managing pins within a project.

Purpose: Users need to see, filter, and manage their pins efficiently. Table view gives information density; grid view gives visual Pinterest context.
Output: Pins list component, pin card component, status badge component, and shadcn checkbox primitive.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/04-pin-management/04-CONTEXT.md
@src/components/articles/articles-table.tsx
@src/types/pins.ts
@src/lib/hooks/use-pins.ts
@src/lib/api/pins.ts
@src/components/ui/table.tsx
@src/components/ui/tabs.tsx
@src/components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pin status badge and add checkbox primitive</name>
  <files>src/components/pins/pin-status-badge.tsx, src/components/ui/checkbox.tsx</files>
  <action>
**PinStatusBadge component:**
A small reusable badge that displays a pin's status with the correct color.

```typescript
interface PinStatusBadgeProps {
  status: PinStatus
  disabled?: boolean  // For Phase 4 non-active statuses (greyed out)
}
```

- Import `PIN_STATUS` and `getStatusBadgeClasses` from `@/types/pins`
- Render a `<span>` with the status label text and background/text color classes from `getStatusBadgeClasses(status)`
- If `disabled` prop is true, apply `opacity-50` to indicate a future/inactive status
- Use rounded-full pill shape, text-xs font-medium, px-2.5 py-0.5 (matching existing frequency badge pattern in `$id.tsx`)

**Checkbox component:**
Install shadcn/ui Checkbox using the shadcn CLI:
```bash
npx shadcn@latest add checkbox
```
This creates `src/components/ui/checkbox.tsx` with the Radix UI Checkbox primitive.
  </action>
  <verify>`npx tsc --noEmit` passes. PinStatusBadge renders correct colors for each status. Checkbox component exists.</verify>
  <done>PinStatusBadge component renders colored pills for all 12 statuses with disabled state support. shadcn Checkbox primitive installed.</done>
</task>

<task type="auto">
  <name>Task 2: Create pins list with table/grid views and bulk actions</name>
  <files>src/components/pins/pins-list.tsx, src/components/pins/pin-card.tsx</files>
  <action>
**PinsList component (`pins-list.tsx`):**

Props:
```typescript
interface PinsListProps {
  projectId: string
}
```

**Layout structure:**
1. **Status filter tabs** at top using shadcn Tabs (same pattern as ArticlesTable Active/Archived):
   - All | Entwurf | Bereit fur Generierung | Fehler
   - Filter pins by status when a tab is selected (client-side filter)
   - "All" shows all pins

2. **Toolbar row** below tabs:
   - Left: View toggle (two icon buttons: table icon, grid icon) — default is table
   - Left: Select all checkbox (when in table view)
   - Right: Bulk actions (visible when 1+ pins selected):
     - "Delete ({n})" button — red, calls useBulkDeletePins with confirm dialog
     - "Change Status" dropdown — shows PHASE4_ACTIVE_STATUSES, calls useBulkUpdatePinStatus
   - Right: Sort dropdown (title, status, created_at, updated_at)

3. **Table view** (default):
   - Use shadcn Table component (same pattern as ArticlesTable)
   - Columns: Checkbox | Image (small ~48px thumbnail) | Title (link to pin detail) | Article (link to article) | Status (PinStatusBadge) | Created | Actions (dropdown: Edit, Delete)
   - Image thumbnail: use `getPinImageUrl(pin.image_path)` for src
   - Title: if null, show "Untitled" in italic slate-400
   - Article: show truncated article title
   - Sortable column headers (client-side, same pattern as ArticlesTable)
   - Row click checkbox toggles selection

4. **Grid view:**
   - Responsive grid: 2 cols on sm, 3 on md, 4 on lg
   - Use PinCard component for each pin
   - Checkbox overlay at top-left of each card

5. **Empty state:** When no pins exist, show centered message "No pins yet. Upload images to create pins." with an upload icon.

6. **Loading state:** Same spinner pattern as ArticlesTable.

**Selection state management:**
- `useState<Set<string>>` for selected pin IDs
- "Select all" checkbox toggles all visible (filtered) pins
- Clear selection when tab changes or bulk action completes

**Bulk delete confirmation:** Use `window.confirm()` for simplicity (consistent with browser-native patterns, no need for a custom dialog for destructive bulk operations).

**PinCard component (`pin-card.tsx`):**
```typescript
interface PinCardProps {
  pin: Pin
  selected: boolean
  onToggleSelect: (id: string) => void
  imageUrl: string
}
```
- Card with image covering full card area (aspect-[2/3] for Pinterest ratio)
- Image uses object-cover
- Bottom overlay (dark gradient) with: title (or "Untitled"), status badge
- Top-left: Checkbox overlay (visible on hover + when selected)
- Clicking card (not checkbox) navigates to pin detail page via TanStack Router Link
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. Pins list renders empty state when no pins exist
3. Table and grid toggle switches between views
4. Status tabs filter pins correctly
5. Checkbox selection enables bulk action buttons
  </verify>
  <done>PinsList with table/grid toggle, status filter tabs, client-side sorting, checkbox selection, and bulk delete/status change bar. PinCard shows image with status overlay for grid view.</done>
</task>

</tasks>

<verification>
- Table view shows image thumbnail, title, article, status badge, date, and actions
- Grid view shows image cards with status overlay and selection checkbox
- Status tabs filter (All, Entwurf, Bereit fur Generierung, Fehler)
- Bulk select with "Select all" and individual checkboxes
- Bulk delete prompts confirmation then deletes
- Bulk status change dropdown with Phase 4 active statuses
- Client-side sorting by title, status, created_at
- Empty state shown when no pins exist
</verification>

<success_criteria>
User can view pins in both table and grid modes, filter by status, select multiple pins, and perform bulk delete or status change operations. All views show pin images from Supabase Storage.
</success_criteria>

<output>
After completion, create `.planning/phases/04-pin-management/04-04-SUMMARY.md`
</output>
