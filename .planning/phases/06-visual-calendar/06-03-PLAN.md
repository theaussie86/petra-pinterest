---
phase: 06-visual-calendar
plan: 03
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - src/components/calendar/pin-sidebar.tsx
  - src/routes/_authed/calendar.tsx
autonomous: true

must_haves:
  truths:
    - "User can click a pin thumbnail on the calendar to open a right sidebar panel"
    - "Sidebar shows full pin details: image, title, description, alt text, status, board, schedule, metadata controls"
    - "User can edit all pin fields from the sidebar without navigating away"
    - "Calendar remains visible and interactive while sidebar is open"
    - "Sidebar is scrollable for all fields in compact layout"
  artifacts:
    - path: "src/components/calendar/pin-sidebar.tsx"
      provides: "Right sidebar panel with full pin editing capabilities"
      contains: "PinSidebar"
  key_links:
    - from: "src/routes/_authed/calendar.tsx"
      to: "src/components/calendar/pin-sidebar.tsx"
      via: "selectedPinId state drives sidebar visibility"
      pattern: "PinSidebar"
    - from: "src/components/calendar/pin-sidebar.tsx"
      to: "src/lib/hooks/use-pins.ts"
      via: "usePin for detail data, useUpdatePin for editing"
      pattern: "usePin|useUpdatePin"
---

<objective>
Build the pin detail sidebar that opens when clicking a pin on the calendar, supporting full editing without navigation.

Purpose: Enables rapid pin inspection and editing directly from the calendar view. Users can click any pin thumbnail to open a ~350px right sidebar with all the fields from the pin detail page in a compact, scrollable layout.

Output: Clicking a pin thumbnail opens a right sidebar with full pin editing capabilities while the calendar remains visible and interactive.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-visual-calendar/06-01-SUMMARY.md
@.planning/phases/06-visual-calendar/06-02-SUMMARY.md
@src/routes/_authed/pins/$pinId.tsx
@src/components/pins/edit-pin-dialog.tsx
@src/components/pins/schedule-pin-section.tsx
@src/components/pins/generate-metadata-button.tsx
@src/types/pins.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PinSidebar component with full editing capabilities</name>
  <files>src/components/calendar/pin-sidebar.tsx</files>
  <action>
Create `src/components/calendar/pin-sidebar.tsx`:

**Props:**
```typescript
interface PinSidebarProps {
  pinId: string | null
  onClose: () => void
}
```

**Data fetching:**
- `usePin(pinId)` for pin detail data (when pinId is not null)
- `useBoards(pin.blog_project_id)` for board dropdown
- `useArticle(pin.blog_article_id)` for linked article name

**Layout (rendered when pinId is not null):**
Fixed-position right sidebar:
- Width: `w-[350px]` (fixed)
- Height: full viewport minus header (`h-[calc(100vh-64px)]` since header is h-16)
- Position: `fixed right-0 top-16` (below header)
- Background: `bg-white border-l border-slate-200 shadow-lg`
- z-index: `z-40` (below header at z-50)
- Overflow: `overflow-y-auto` for scrolling
- Transition: slide in from right with `transition-transform duration-200`

**Sidebar content (scrollable, p-4 space-y-4):**

1. **Header row:** "Pin Details" title + close button (X icon) aligned right

2. **Pin image:** Small preview (max-h-[200px], w-full, object-contain, rounded-lg, bg-slate-100)

3. **Inline edit form** (NOT a dialog â€” fields are directly in the sidebar):
   Use `useForm` from react-hook-form with same schema as EditPinDialog.

   Fields:
   - Title: Input field
   - Description: Textarea (3 rows)
   - Alt Text: Textarea (2 rows)
   - Board: Select dropdown (same pattern as EditPinDialog)
   - Status: Select dropdown (same pattern as EditPinDialog)

   Save button: "Save Changes" button at bottom of form section. Calls `useUpdatePin().mutateAsync()`.
   Auto-close behavior: do NOT close sidebar on save (user stays to continue editing or viewing).

4. **Schedule section:** Reuse `SchedulePinSection` component (pass the pin object). It already handles date/time picking and scheduling mutations.

5. **AI Metadata section:** Reuse `GenerateMetadataButton` component.
   Include metadata history and regenerate feedback dialogs (MetadataHistoryDialog, RegenerateFeedbackDialog) with local state.

6. **Article link:** Show linked article title as a Link to `/articles/$articleId`

7. **Actions footer:**
   - "Open Full Detail" link to `/pins/$pinId` (for users who want the full detail page)
   - "Delete" button opening DeletePinDialog

**Loading state:** When pin data is loading, show a skeleton:
- Image placeholder (h-[200px] bg-slate-100 animate-pulse)
- 4 text line placeholders

**Closing behavior:**
- X button calls `onClose()`
- Escape key calls `onClose()` (add useEffect with keydown listener)
- Clicking outside sidebar does NOT close it (calendar interaction should still work)
  </action>
  <verify>TypeScript compiles with `npx tsc --noEmit`</verify>
  <done>PinSidebar component exists with image preview, inline edit form, schedule section, metadata controls, article link, and actions</done>
</task>

<task type="auto">
  <name>Task 2: Wire sidebar into calendar route with pin click handling</name>
  <files>src/routes/_authed/calendar.tsx</files>
  <action>
Update `src/routes/_authed/calendar.tsx`:

**State:**
- Add `selectedPinId` state (string | null, default null)

**Pin click handler:**
- Create `handlePinClick = (pinId: string) => setSelectedPinId(pinId)`
- Pass this as `onPinClick` prop to `CalendarGrid` (replacing the no-op from Plan 02)

**Layout adjustment:**
When sidebar is open, the main content area should shrink to make room:
- Wrap calendar content in a div with `transition-all duration-200`
- When `selectedPinId` is set: add `mr-[350px]` to the main content area (pushes content left to avoid overlap)
- When null: no margin

**Render sidebar:**
- Import and render `PinSidebar` after the main content
- Pass `pinId={selectedPinId}` and `onClose={() => setSelectedPinId(null)}`
- Only render when `selectedPinId` is not null (or render always but let PinSidebar handle visibility internally)

**Verify interactions:**
- Clicking a pin thumbnail in a day cell opens sidebar with that pin's details
- Clicking a different pin changes the sidebar content
- Clicking X or pressing Escape closes the sidebar
- Calendar navigation still works while sidebar is open
- Filter changes still work while sidebar is open
  </action>
  <verify>
Run `npm run dev` and verify:
1. Click a pin thumbnail on the calendar -> right sidebar opens
2. Sidebar shows pin image, title, description, alt text, status, board
3. Edit fields in sidebar and click Save -> pin updates, sidebar stays open
4. Schedule section works in sidebar
5. "Open Full Detail" link navigates to pin detail page
6. X button and Escape key close sidebar
7. Calendar remains interactive while sidebar is open
8. Calendar content shifts left to avoid overlap with sidebar
9. Clicking different pin updates sidebar content
  </verify>
  <done>Clicking a pin on the calendar opens a right sidebar with full editing, calendar remains interactive, sidebar can be closed</done>
</task>

</tasks>

<verification>
1. Pin click opens right sidebar (~350px) with pin details
2. Sidebar shows image, inline edit form, schedule, metadata controls
3. Editing and saving works without closing sidebar
4. Calendar remains visible and interactive while sidebar is open
5. Sidebar is scrollable for long content
6. Close via X button or Escape key
7. Content shifts to make room for sidebar
8. Different pin clicks update sidebar content
9. TypeScript compiles cleanly
</verification>

<success_criteria>
Users can click any pin thumbnail on the calendar to open a right sidebar panel. The sidebar displays full pin details and supports inline editing, scheduling, and metadata generation. The calendar remains visible and interactive while the sidebar is open.
</success_criteria>

<output>
After completion, create `.planning/phases/06-visual-calendar/06-03-SUMMARY.md`
</output>
