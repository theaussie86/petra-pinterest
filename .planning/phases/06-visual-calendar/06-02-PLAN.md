---
phase: 06-visual-calendar
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/calendar/calendar-grid.tsx
  - src/components/calendar/calendar-day-cell.tsx
  - src/components/calendar/calendar-header.tsx
  - src/routes/_authed/calendar.tsx
autonomous: true

must_haves:
  truths:
    - "User can view scheduled pins on a month grid with thumbnail images in day cells"
    - "User can switch to week view showing 7 larger day columns with more space for thumbnails"
    - "User can navigate between months/weeks using prev/next buttons and a today button"
    - "Overflow pins show '+N more' badge that opens a popover listing all pins for that day"
    - "Pin thumbnails show status-colored borders/badges for at-a-glance status"
  artifacts:
    - path: "src/components/calendar/calendar-grid.tsx"
      provides: "Main calendar component with month/week toggle and navigation"
      contains: "CalendarGrid"
    - path: "src/components/calendar/calendar-day-cell.tsx"
      provides: "Day cell with pin thumbnails, overflow badge, and popover"
      contains: "CalendarDayCell"
    - path: "src/components/calendar/calendar-header.tsx"
      provides: "Calendar navigation (prev/next/today) and view toggle"
      contains: "CalendarHeader"
  key_links:
    - from: "src/routes/_authed/calendar.tsx"
      to: "src/components/calendar/calendar-grid.tsx"
      via: "Component composition"
      pattern: "CalendarGrid"
    - from: "src/components/calendar/calendar-grid.tsx"
      to: "src/components/calendar/calendar-day-cell.tsx"
      via: "Renders day cells in grid"
      pattern: "CalendarDayCell"
    - from: "src/components/calendar/calendar-day-cell.tsx"
      to: "date-fns"
      via: "Date computation"
      pattern: "startOfMonth|startOfWeek|addDays"
---

<objective>
Build the visual calendar grid component with Month and Week views, pin thumbnails in day cells, overflow handling, and navigation controls.

Purpose: This is the core visual element of Phase 6 — the calendar grid that displays scheduled pins as thumbnails within day cells, with month/week toggle and standard navigation.

Output: Working calendar grid replacing the calendar placeholder, showing scheduled pins as thumbnails with status-colored indicators.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-visual-calendar/06-01-SUMMARY.md
@src/types/pins.ts
@src/lib/api/pins.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build CalendarHeader, CalendarDayCell, and CalendarGrid components</name>
  <files>src/components/calendar/calendar-header.tsx, src/components/calendar/calendar-day-cell.tsx, src/components/calendar/calendar-grid.tsx</files>
  <action>
Create `src/components/calendar/` directory with three components.

**CalendarHeader (`calendar-header.tsx`):**
Props: `{ currentDate: Date, view: 'month' | 'week', onNavigate: (direction: 'prev' | 'next' | 'today') => void, onViewChange: (view: 'month' | 'week') => void }`

Layout:
- Left: Prev button (ChevronLeft icon), Today button, Next button (ChevronRight icon)
- Center: Current period label — "January 2026" for month, "Jan 6 - 12, 2026" for week (using date-fns `format`)
- Right: Month/Week toggle (segmented control with two buttons, similar to table/grid toggle pattern)

**CalendarDayCell (`calendar-day-cell.tsx`):**
Props: `{ date: Date, pins: Pin[], isCurrentMonth: boolean, isToday: boolean, view: 'month' | 'week', onPinClick: (pinId: string) => void }`

Structure:
- Day number in top-left corner (muted if not current month)
- Pin thumbnails:
  - In month view: show up to 3 thumbnails (small ~32x32px with rounded corners)
  - In week view: show up to 6 thumbnails (larger ~48x48px)
  - Each thumbnail: `<img>` with `getPinImageUrl(pin.image_path)`, wrapped in a clickable div
  - Each thumbnail has a status-colored border (2px) using a color derived from `PIN_STATUS[pin.status].color`:
    - slate -> border-slate-400, blue -> border-blue-400, violet -> border-violet-400, teal -> border-teal-400, green -> border-green-400, emerald -> border-emerald-400, red -> border-red-400, gray -> border-gray-300
  - Thumbnails use `loading="lazy"` for performance
- Overflow: If pins exceed the visible limit, show a "+N more" badge button
  - Badge styled as small rounded pill: `bg-slate-100 text-slate-600 text-xs px-2 py-0.5`
  - Clicking opens a Popover (shadcn/ui) listing all pins for that day:
    - Each item: small thumbnail (24x24) + pin title (truncated) + status badge
    - Items are clickable (calls `onPinClick`)
- Cell styling:
  - `min-h-[100px]` for month, `min-h-[160px]` for week
  - `bg-white` for current month days, `bg-slate-50/50` for other month days
  - Today: `ring-2 ring-blue-400` border
  - Hover: subtle `bg-slate-50` background

**CalendarGrid (`calendar-grid.tsx`):**
Props: `{ pins: Pin[], view: 'month' | 'week', onPinClick: (pinId: string) => void }`

State:
- `currentDate` (Date) — the reference date for navigation (defaults to today)

Logic:
- **Month view:** Use date-fns to compute a 6-row x 7-column grid:
  - `startOfMonth(currentDate)` -> get the first day
  - `startOfWeek(startOfMonth(...), { weekStartsOn: 1 })` -> get the Monday of the first week
  - Generate 42 days (6 weeks) using `addDays`
  - Group pins by date using `format(scheduledAt, 'yyyy-MM-dd')` as key
- **Week view:** Compute 7 days:
  - `startOfWeek(currentDate, { weekStartsOn: 1 })` -> Monday
  - Generate 7 days using `addDays`
  - Group pins by date similarly

Grid layout:
- Day-of-week header row: Mon, Tue, Wed, Thu, Fri, Sat, Sun
- CSS grid: `grid-cols-7` with `divide-x divide-y` borders
- Month view: 6 rows of CalendarDayCell
- Week view: 1 row of CalendarDayCell (taller cells)

Combine CalendarHeader + grid into one component export. Navigation handler:
- prev: `subMonths(currentDate, 1)` or `subWeeks(currentDate, 1)`
- next: `addMonths(currentDate, 1)` or `addWeeks(currentDate, 1)`
- today: `new Date()`
  </action>
  <verify>TypeScript compiles with `npx tsc --noEmit`</verify>
  <done>CalendarHeader, CalendarDayCell, and CalendarGrid components exist with month/week views, navigation, pin thumbnails, status borders, and overflow popovers</done>
</task>

<task type="auto">
  <name>Task 2: Wire CalendarGrid into calendar route replacing placeholder</name>
  <files>src/routes/_authed/calendar.tsx</files>
  <action>
Update `src/routes/_authed/calendar.tsx` to replace the "Calendar view placeholder" div:

- Import `CalendarGrid` from `@/components/calendar/calendar-grid`
- Pass the `scheduledPins` (filtered pins with scheduled_at !== null) as the `pins` prop
- Pass the calendar `view` state ('month' | 'week') — store in URL search params (add `view: 'month' | 'week'` to search params with default 'month')
- Pass `onPinClick` handler — for now, this is a no-op or `console.log` (sidebar will be added in Plan 03)

Add a loading skeleton state for the calendar:
- While `useAllPins()` isLoading, show a grid skeleton:
  - 7-column header row with day abbreviations
  - 6x7 grid of `bg-slate-100 animate-pulse rounded` divs (matching cell dimensions)

Add empty state when no scheduled pins match filters:
- "No scheduled pins match your filters." message in the calendar area
  </action>
  <verify>
Run `npm run dev` and verify:
1. Navigate to /calendar — calendar grid renders with day cells
2. Scheduled pins appear as thumbnails in their respective day cells
3. Pin thumbnails have status-colored borders
4. Month/Week toggle switches between views
5. Navigation (prev/next/today) works
6. "+N more" badge appears when many pins on one day
7. Clicking "+N more" opens popover with pin list
8. Loading skeleton shows during data fetch
  </verify>
  <done>Calendar grid renders scheduled pins as thumbnails with status borders, month/week toggle works, navigation works, overflow popover works</done>
</task>

</tasks>

<verification>
1. Month view shows 6-week grid with pin thumbnails in day cells
2. Week view shows 7 larger columns with more thumbnail space
3. Pin thumbnails have status-colored borders
4. Navigation buttons (prev/next/today) change the displayed period
5. Month/Week toggle switches views correctly
6. "+N more" overflow badge appears and opens popover
7. Popover lists all pins for a day with thumbnails, titles, and status badges
8. Loading skeleton shows during data fetch
9. Empty state shown when no pins match filters
10. TypeScript compiles cleanly
</verification>

<success_criteria>
Visual calendar grid renders scheduled pins as thumbnails with status-colored borders. Users can switch between month and week views, navigate between periods, and see overflow popovers for days with many pins.
</success_criteria>

<output>
After completion, create `.planning/phases/06-visual-calendar/06-02-SUMMARY.md`
</output>
