---
phase: 03-blog-scraping-articles
plan: 04
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/routes/_authed/articles/$articleId.tsx
  - src/lib/utils.ts
  - src/styles.css
  - src/routeTree.gen.ts
autonomous: true

must_haves:
  truths:
    - "User can view an article detail page with full scraped content"
    - "Article detail shows title, publish date, source URL, and pin count"
    - "Article content is rendered as sanitized HTML"
    - "User can navigate back to the project detail page"
    - "User can archive the article from the detail page"
  artifacts:
    - path: "src/routes/_authed/articles/$articleId.tsx"
      provides: "Article detail page route"
      contains: "createFileRoute"
    - path: "src/lib/utils.ts"
      provides: "sanitizeHtml helper function"
      contains: "sanitizeHtml"
    - path: "src/routeTree.gen.ts"
      provides: "Updated route tree with article detail route"
      contains: "ArticlesArticleIdRoute"
  key_links:
    - from: "src/routes/_authed/articles/$articleId.tsx"
      to: "src/lib/hooks/use-articles.ts"
      via: "useArticle hook"
      pattern: "useArticle"
---

<objective>
Create the article detail page that displays full scraped article content with metadata header.

Purpose: Users need to view the complete scraped content of articles to understand what content is available for pin creation. This completes the article browsing experience started by the articles table.

Output: A new route that renders article metadata and full content.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/03-blog-scraping-articles/03-CONTEXT.md

# Existing route pattern to follow:
@src/routes/_authed/projects/$id.tsx
@src/routes/_authed.tsx

# Data layer:
@src/types/articles.ts
@src/lib/hooks/use-articles.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create article detail route with content rendering</name>
  <files>src/routes/_authed/articles/$articleId.tsx, src/lib/utils.ts, src/styles.css</files>
  <action>
**Important route structure note:** The current project detail route is at `src/routes/_authed/projects/$id.tsx`. For the article detail route to be nested under a project, we need to restructure slightly. The article detail route should be at:

`src/routes/_authed/projects/$projectId/articles/$articleId.tsx`

However, this creates a conflict with the existing `$id.tsx` file. TanStack Router file-based routing requires either:
- Option A: Rename `$id.tsx` to `$projectId.tsx` (breaking change)
- Option B: Use a different route structure like `_authed/articles/$articleId.tsx` with projectId as a search param

**Choose Option B** to avoid breaking the existing project detail route. Create the article detail at:
`src/routes/_authed/articles/$articleId.tsx`

The route will receive the articleId as a param and derive the projectId from the article data itself.

Create `src/routes/_authed/articles/$articleId.tsx`:

```typescript
import { createFileRoute, Link } from '@tanstack/react-router'
```

**Route definition:**
```typescript
export const Route = createFileRoute('/_authed/articles/$articleId')({
  component: ArticleDetail,
})
```

**Component structure:**

```
function ArticleDetail() {
  const { user } = Route.useRouteContext()
  const { articleId } = Route.useParams()
  const { data: article, isLoading, error } = useArticle(articleId)
  // Archive mutation for the action button
  const archiveMutation = useArchiveArticle()

  // Loading state (same spinner pattern as project detail)
  // Error state (same pattern)

  // Main content:
  return (
    <div className="min-h-screen bg-slate-50">
      <Header user={user} />
      <main className="container mx-auto px-4 py-8 max-w-4xl">
        {/* Back navigation - link to project detail */}
        <div className="mb-6">
          <Link to="/projects/$id" params={{ id: article.blog_project_id }}>
            <Button variant="ghost" size="sm">
              <ArrowLeft className="mr-2 h-4 w-4" />
              Back to Project
            </Button>
          </Link>
        </div>

        {/* Article metadata header */}
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-slate-900 mb-3">{article.title}</h1>
          <div className="flex flex-wrap items-center gap-4 text-sm text-slate-600">
            {article.published_at && (
              <span>Published {formatDate(article.published_at)}</span>
            )}
            <span>Scraped {formatDate(article.scraped_at)}</span>
            <a href={article.url} target="_blank" rel="noopener noreferrer"
               className="flex items-center gap-1 text-blue-600 hover:text-blue-700 hover:underline">
              Source <ExternalLink className="h-3 w-3" />
            </a>
            <span className="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-0.5 text-xs font-medium text-slate-700">
              0 pins
            </span>
          </div>
        </div>

        {/* Action buttons */}
        <div className="flex gap-3 mb-8">
          <Button variant="outline" size="sm"
            onClick={() => archiveMutation.mutate(article.id)}
            disabled={archiveMutation.isPending}
            className="text-red-600 hover:text-red-700 hover:bg-red-50">
            {archiveMutation.isPending ? 'Archiving...' : 'Archive Article'}
          </Button>
        </div>

        {/* Article content */}
        <Card>
          <CardContent className="prose prose-slate max-w-none py-6">
            {article.content ? (
              <div dangerouslySetInnerHTML={{ __html: sanitizeHtml(article.content) }} />
            ) : (
              <p className="text-slate-500 italic">No content available. The article content could not be scraped.</p>
            )}
          </CardContent>
        </Card>
      </main>
    </div>
  )
}
```

**Content sanitization â€” create a simple sanitizeHtml helper:**
- Strip `<script>`, `<style>`, `<iframe>`, `<object>`, `<embed>` tags
- Strip `on*` event handler attributes (onclick, onload, etc.)
- Allow standard content tags: p, h1-h6, a, img, ul, ol, li, blockquote, pre, code, em, strong, br, hr, table, thead, tbody, tr, th, td, figure, figcaption
- This can be a simple function at the top of the file or in a shared utils file

Place the sanitizeHtml function in `src/lib/utils.ts` (add to existing file) so it can be reused:
```typescript
export function sanitizeHtml(html: string): string {
  // Remove script, style, iframe, object, embed tags and their content
  let clean = html.replace(/<(script|style|iframe|object|embed)[^>]*>[\s\S]*?<\/\1>/gi, '')
  // Remove event handlers
  clean = clean.replace(/\s+on\w+\s*=\s*("[^"]*"|'[^']*'|[^\s>]+)/gi, '')
  // Remove javascript: URLs
  clean = clean.replace(/href\s*=\s*["']javascript:[^"']*["']/gi, '')
  return clean
}
```

**Tailwind Typography:** The article content uses `prose prose-slate` classes for nice typography. Check if @tailwindcss/typography is installed. If not, install it with `npm install @tailwindcss/typography` and add it to the Tailwind config. If there's no tailwind.config.js (Tailwind v4 uses CSS-based config), add the typography plugin import in `src/styles.css` using `@plugin "@tailwindcss/typography"`.

**Format date helper:** Reuse the same formatDate pattern from the project detail page (toLocaleDateString with year, month, day options). Can be defined inline or extracted to utils.

**After archive:** Navigate back to the project detail page using `useNavigate()` after successful archive (similar to the delete pattern from project detail).

Import Header from `@/components/layout/header`, Button from `@/components/ui/button`, Card/CardContent from `@/components/ui/card`, icons from lucide-react (ArrowLeft, ExternalLink), hooks from `@/lib/hooks/use-articles`.
  </action>
  <verify>
File exists at the correct route path. Run `npm run dev` briefly to trigger route tree generation, then run `npm run build` to verify TypeScript compilation. Check that `src/routeTree.gen.ts` includes the new article detail route. Verify `@tailwindcss/typography` is in package.json dependencies and `@plugin "@tailwindcss/typography"` is in src/styles.css. Verify `sanitizeHtml` is exported from src/lib/utils.ts.
  </verify>
  <done>
Article detail page renders with metadata header (title, dates, source URL, pin count), action buttons (archive), and full article content with HTML sanitization. Back navigation returns to the project. Route tree is auto-generated. Typography plugin is installed and configured for prose styling. sanitizeHtml utility is in shared utils.
  </done>
</task>

</tasks>

<verification>
1. Route file exists at the correct path under `_authed/`
2. Route tree (`routeTree.gen.ts`) includes the article detail route
3. Article detail page shows title, dates, source URL, pin count
4. Article content renders as sanitized HTML (no script tags, no event handlers)
5. Archive button works and navigates back to project
6. Back navigation link returns to the correct project
7. Tailwind Typography plugin installed and prose styles applied
8. `npm run build` passes with zero TypeScript errors
</verification>

<success_criteria>
- User can click an article title in the table and see the full article detail
- Article detail shows metadata header + full content
- Content is sanitized (no XSS vectors)
- User can archive the article and is redirected back to the project
- Back navigation works correctly
- Typography is well-styled for article content
</success_criteria>

<output>
After completion, create `.planning/phases/03-blog-scraping-articles/03-04-SUMMARY.md`
</output>
