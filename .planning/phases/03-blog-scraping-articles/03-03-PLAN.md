---
phase: 03-blog-scraping-articles
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/ui/table.tsx
  - src/components/articles/articles-table.tsx
  - src/components/articles/scrape-button.tsx
  - src/components/articles/add-article-dialog.tsx
  - src/routes/_authed/projects/$id.tsx
autonomous: true

must_haves:
  truths:
    - "User can view a sortable table of articles for a blog project"
    - "User can trigger a blog scrape and see inline progress feedback"
    - "User can manually add an article by URL"
    - "Articles table shows title, date, pin count (0 for now), and URL"
    - "User can archive an article from the table"
    - "User can view archived articles and restore them"
    - "Article table defaults to newest-first sort"
  artifacts:
    - path: "src/components/ui/table.tsx"
      provides: "shadcn/ui Table primitives"
      contains: "TableHeader"
    - path: "src/components/articles/articles-table.tsx"
      provides: "Article list table with sorting"
      contains: "ArticlesTable"
    - path: "src/components/articles/scrape-button.tsx"
      provides: "Scrape trigger button with progress state"
      contains: "ScrapeButton"
    - path: "src/components/articles/add-article-dialog.tsx"
      provides: "Manual article addition dialog"
      contains: "AddArticleDialog"
    - path: "src/routes/_authed/projects/$id.tsx"
      provides: "Project detail page with articles section"
      contains: "ArticlesTable"
  key_links:
    - from: "src/components/articles/articles-table.tsx"
      to: "src/lib/hooks/use-articles.ts"
      via: "useArticles hook"
      pattern: "useArticles"
    - from: "src/components/articles/scrape-button.tsx"
      to: "src/lib/hooks/use-articles.ts"
      via: "useScrapeBlog hook"
      pattern: "useScrapeBlog"
    - from: "src/routes/_authed/projects/$id.tsx"
      to: "src/components/articles/articles-table.tsx"
      via: "component import"
      pattern: "import.*ArticlesTable"
---

<objective>
Build the articles list UI on the project detail page: sortable table, scrape button with inline progress, and manual article addition dialog.

Purpose: This is the primary user-facing deliverable of Phase 3 — users can view their scraped articles, trigger scrapes, and manually add articles. Replaces the placeholder articles card on the project detail page.

Output: Working articles section on the project detail page with full CRUD-like functionality (view, scrape, add, archive).
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/03-blog-scraping-articles/03-CONTEXT.md

# Existing UI patterns to follow:
@src/routes/_authed/projects/$id.tsx
@src/components/projects/project-dialog.tsx
@src/components/projects/delete-dialog.tsx
@src/components/dashboard/project-card.tsx

# Data layer (from Plan 02):
@src/types/articles.ts
@src/lib/hooks/use-articles.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn/ui Table component and create articles table</name>
  <files>src/components/ui/table.tsx, src/components/articles/articles-table.tsx</files>
  <action>
**1. Add shadcn/ui Table component:**

Use `npx shadcn@latest add table` to install the Table component. If the CLI doesn't work, manually create `src/components/ui/table.tsx` with the standard shadcn/ui table primitives (Table, TableHeader, TableBody, TableFooter, TableHead, TableRow, TableCell, TableCaption). Follow the exact shadcn/ui pattern used for other UI components in the project.

**2. Create `src/components/articles/articles-table.tsx`:**

Props interface:
```typescript
interface ArticlesTableProps {
  projectId: string
}
```

The component:
- Uses `useArticles(projectId)` hook to fetch articles
- Manages local sort state: `sortField` (default: 'published_at') and `sortDirection` (default: 'desc')
- Renders a shadcn/ui Table with these columns:
  - **Title** — sortable, clickable (links to article detail page `/articles/$articleId` with params `{ articleId: article.id }`)
  - **Date** — sortable, displays published_at formatted as "Jan 27, 2026" or "No date" if null
  - **Pin Count** — sortable, hard-coded to 0 for now (pins don't exist yet), displays as badge
  - **URL** — external link icon, opens in new tab, truncated to domain name
  - **Actions** — dropdown or button with "Archive" option using useArchiveArticle hook

Sorting: Client-side sorting on the fetched data. When user clicks a column header, toggle sort direction (asc/desc). Use arrow icons (lucide-react: ArrowUp, ArrowDown, ArrowUpDown) to indicate current sort state.

Empty state: When no articles exist, show a centered message: "No articles yet. Scrape your blog or add an article manually."

Loading state: Show a spinner (same pattern as project detail page loading state).

Error state: Show error message with retry button.

Style the table with alternating row colors, hover states, and proper Tailwind classes. Use `text-sm` for table content. Truncate long titles with ellipsis (max-width with overflow-hidden).

The title column should use TanStack Router `<Link>` to navigate to article detail (use path `/articles/$articleId` with params `{ articleId: article.id }`).

**Archived articles toggle:**
- Add a toggle/tab above the table to switch between "Active" (default) and "Archived" views
- Use a simple state variable: `const [showArchived, setShowArchived] = useState(false)`
- When "Archived" is selected, use `useArchivedArticles(projectId)` hook instead of `useArticles(projectId)`
- In archived view, replace the "Archive" action with a "Restore" action using `useRestoreArticle()` hook
- Archived view shows the same table columns plus an "Archived on" date (from archived_at field)
- The toggle can be a pair of buttons or a shadcn/ui Tabs component (e.g., `<Tabs defaultValue="active">` with "Active" and "Archived" tab triggers)
- Empty state for archived tab: "No archived articles."
  </action>
  <verify>
Files exist. Run `npm run build` to verify TypeScript compilation. Check that Table component exports all primitives and ArticlesTable renders with proper hooks.
  </verify>
  <done>
shadcn/ui Table primitives installed. ArticlesTable component renders a sortable table of articles with title, date, pin count, URL, and archive action. Client-side sorting works on all sortable columns. Empty, loading, and error states handled. Archived articles toggle allows viewing archived articles and restoring them.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create scrape button, add dialog, and integrate on project detail page</name>
  <files>src/components/articles/scrape-button.tsx, src/components/articles/add-article-dialog.tsx, src/routes/_authed/projects/$id.tsx</files>
  <action>
**1. Create `src/components/articles/scrape-button.tsx`:**

Props interface:
```typescript
interface ScrapeButtonProps {
  blogProjectId: string
  blogUrl: string
  rssUrl: string | null
}
```

The component:
- Uses `useScrapeBlog()` mutation hook
- Renders a Button that triggers scraping when clicked
- **Normal state:** "Scrape Blog" with a RefreshCw icon
- **Loading state (isPending):** Button disabled, shows spinner icon + "Scraping..." text, uses animate-spin on the icon
- **Success state:** Briefly shows green checkmark + result summary (e.g., "5 new, 2 updated"), then reverts to normal after 3 seconds (use setTimeout)
- **Error state:** Shows inline error message below the button (not just toast — CONTEXT.md says "Errors shown inline near the scrape button"). Use red text, e.g., "RSS feed not found. Check blog URL or add RSS URL manually."

On click, calls the mutation with: `{ blog_project_id: blogProjectId, blog_url: blogUrl, rss_url: rssUrl }`

**2. Create `src/components/articles/add-article-dialog.tsx`:**

Props interface:
```typescript
interface AddArticleDialogProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  projectId: string
}
```

The component:
- Uses `useAddArticle()` mutation hook
- Dialog with a single URL input field
- Uses react-hook-form + zod for URL validation (must be a valid URL starting with http:// or https://)
- Submit button says "Add Article" with loading state
- On success, close dialog and reset form
- On error, show error message in the dialog
- Follow the exact Dialog pattern from ProjectDialog (same shadcn/ui primitives, same form handling approach)

**3. Update `src/routes/_authed/projects/$id.tsx`:**

Replace the Articles placeholder card with the real articles section:

- Remove the existing placeholder Card with FileText icon and "Articles will appear here" message
- Add a full-width articles section (not in the 2-column grid — articles should span full width above the pins placeholder)
- Section structure:
  ```
  <div className="mb-8">
    <div className="flex items-center justify-between mb-4">
      <h2 className="text-xl font-semibold flex items-center gap-2">
        <FileText className="h-5 w-5" />
        Articles
      </h2>
      <div className="flex gap-2">
        <Button variant="outline" size="sm" onClick={() => setAddDialogOpen(true)}>
          <Plus className="h-4 w-4 mr-1" /> Add Article
        </Button>
        <ScrapeButton blogProjectId={id} blogUrl={project.blog_url} rssUrl={project.rss_url} />
      </div>
    </div>
    <ArticlesTable projectId={id} />
  </div>
  ```
- Keep the Pins placeholder card as a single card below (no longer in a 2-column grid)
- Add state for AddArticleDialog: `const [addDialogOpen, setAddDialogOpen] = useState(false)`
- Add AddArticleDialog at the bottom with the other dialogs
- Import all new components: ArticlesTable, ScrapeButton, AddArticleDialog, Plus icon from lucide-react
  </action>
  <verify>
All files exist. Run `npm run build` to verify TypeScript compilation. Check that project detail page imports ArticlesTable, ScrapeButton, and AddArticleDialog correctly. Verify the dialog uses react-hook-form with zod validation.
  </verify>
  <done>
ScrapeButton shows inline progress and errors. AddArticleDialog validates URL and triggers manual add. Project detail page shows real articles section with scrape button, add button, and sortable table. Pins placeholder remains as standalone card below.
  </done>
</task>

</tasks>

<verification>
1. shadcn/ui Table component installed and functional
2. ArticlesTable renders with sortable columns (Title, Date, Pin Count, URL)
3. ScrapeButton transitions through normal -> loading -> success/error states
4. AddArticleDialog validates URL and calls the add mutation
5. Project detail page shows articles section replacing the placeholder
6. Archived articles toggle switches between active and archived views
7. Restore action works on archived articles
8. `npm run build` passes with zero TypeScript errors
9. All components follow existing code style (Tailwind classes, shadcn/ui primitives, lucide-react icons)
</verification>

<success_criteria>
- User sees a sortable articles table on the project detail page
- User can click "Scrape Blog" and see inline progress + result
- User can click "Add Article" and enter a URL to manually add content
- User can archive an article from the table
- User can toggle to "Archived" view and restore archived articles
- Empty state is shown when no articles exist
- All components follow established patterns from Phase 2
</success_criteria>

<output>
After completion, create `.planning/phases/03-blog-scraping-articles/03-03-SUMMARY.md`
</output>
