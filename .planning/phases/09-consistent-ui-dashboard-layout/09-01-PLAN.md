---
phase: 09-consistent-ui-dashboard-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/sidebar.tsx
  - src/components/ui/breadcrumb.tsx
  - src/components/layout/loading-spinner.tsx
  - src/components/layout/error-state.tsx
  - src/components/layout/page-layout.tsx
  - src/components/layout/page-header.tsx
  - src/components/layout/app-sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar component is installed and importable from @/components/ui/sidebar"
    - "Breadcrumb component is installed and importable from @/components/ui/breadcrumb"
    - "LoadingSpinner renders an accessible spinner with role=status and sr-only text"
    - "ErrorState renders error message with optional retry button"
    - "PageLayout renders children inside a container with CVA-based maxWidth variants (narrow/medium/wide/full)"
    - "PageLayout shows LoadingSpinner when isLoading=true and ErrorState when error is provided"
    - "PageHeader renders title with optional breadcrumbs and action buttons"
    - "AppSidebar renders Dashboard and Calendar nav items with active state highlighting"
    - "AppSidebar footer shows user avatar, display name, and sign-out option"
  artifacts:
    - path: "src/components/ui/sidebar.tsx"
      provides: "shadcn/ui Sidebar primitives"
    - path: "src/components/ui/breadcrumb.tsx"
      provides: "shadcn/ui Breadcrumb primitives"
    - path: "src/components/layout/loading-spinner.tsx"
      provides: "Shared loading spinner component"
      exports: ["LoadingSpinner"]
    - path: "src/components/layout/error-state.tsx"
      provides: "Shared error state component"
      exports: ["ErrorState"]
    - path: "src/components/layout/page-layout.tsx"
      provides: "Reusable page wrapper with container variants"
      exports: ["PageLayout"]
    - path: "src/components/layout/page-header.tsx"
      provides: "Page header with breadcrumbs, title, and actions"
      exports: ["PageHeader"]
    - path: "src/components/layout/app-sidebar.tsx"
      provides: "Application sidebar with navigation and user menu"
      exports: ["AppSidebar"]
  key_links:
    - from: "src/components/layout/app-sidebar.tsx"
      to: "src/components/ui/sidebar.tsx"
      via: "import Sidebar primitives"
      pattern: "import.*from.*@/components/ui/sidebar"
    - from: "src/components/layout/page-header.tsx"
      to: "src/components/ui/breadcrumb.tsx"
      via: "import Breadcrumb primitives"
      pattern: "import.*from.*@/components/ui/breadcrumb"
    - from: "src/components/layout/page-layout.tsx"
      to: "src/components/layout/loading-spinner.tsx"
      via: "renders LoadingSpinner on isLoading"
      pattern: "import.*LoadingSpinner"
---

<objective>
Install shadcn/ui Sidebar and Breadcrumb components, then create all shared layout components: LoadingSpinner, ErrorState, PageLayout (with CVA container variants), PageHeader (with breadcrumbs), and AppSidebar (with navigation and user menu).

Purpose: Establish the foundation layer that all route migrations will consume. These components replace 11 instances of duplicate page wrapper code and 5 inconsistent loading/error implementations.

Output: 7 new component files ready for consumption by Plans 02 and 03.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-consistent-ui-dashboard-layout/09-RESEARCH.md
@src/components/layout/header.tsx
@src/lib/auth.ts
@src/lib/server/auth.ts
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui Sidebar and Breadcrumb, create LoadingSpinner and ErrorState</name>
  <files>
    src/components/ui/sidebar.tsx
    src/components/ui/breadcrumb.tsx
    src/components/layout/loading-spinner.tsx
    src/components/layout/error-state.tsx
  </files>
  <action>
1. Install shadcn/ui Sidebar component:
   ```bash
   npx shadcn@latest add sidebar -y
   ```
   This installs SidebarProvider, Sidebar, SidebarContent, SidebarHeader, SidebarFooter, SidebarMenu, SidebarMenuItem, SidebarMenuButton, SidebarInset, SidebarRail, SidebarTrigger and related subcomponents.

2. Install shadcn/ui Breadcrumb component:
   ```bash
   npx shadcn@latest add breadcrumb -y
   ```
   This installs Breadcrumb, BreadcrumbList, BreadcrumbItem, BreadcrumbLink, BreadcrumbSeparator, BreadcrumbPage.

3. Create `src/components/layout/loading-spinner.tsx`:
   - Export `LoadingSpinner` component
   - Centered flex container with `py-12`
   - Spinner: `h-8 w-8 animate-spin rounded-full border-4 border-slate-200 border-t-slate-900`
   - Include `role="status"` and `aria-label="Loading"` for accessibility
   - Include `<span className="sr-only">Loading...</span>` inside the spinner div

4. Create `src/components/layout/error-state.tsx`:
   - Export `ErrorState` component
   - Props: `{ error: Error; onRetry?: () => void }`
   - Centered flex column with `py-12 space-y-4`
   - Red AlertCircle icon (12x12) from lucide-react
   - Title: "Something went wrong" in `text-lg font-semibold text-slate-900`
   - Description: `error.message` fallback to "An unexpected error occurred" in `text-sm text-slate-600`
   - Optional "Try again" Button (variant="outline") when `onRetry` provided
  </action>
  <verify>
    - Run `npx tsc --noEmit` — no type errors
    - Confirm `src/components/ui/sidebar.tsx` exists
    - Confirm `src/components/ui/breadcrumb.tsx` exists
    - Confirm `src/components/layout/loading-spinner.tsx` exports LoadingSpinner
    - Confirm `src/components/layout/error-state.tsx` exports ErrorState
  </verify>
  <done>
    shadcn/ui Sidebar and Breadcrumb installed. LoadingSpinner and ErrorState components created with proper accessibility attributes and consistent styling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PageLayout, PageHeader, and AppSidebar components</name>
  <files>
    src/components/layout/page-layout.tsx
    src/components/layout/page-header.tsx
    src/components/layout/app-sidebar.tsx
  </files>
  <action>
1. Create `src/components/layout/page-layout.tsx`:
   - Import CVA from `class-variance-authority`
   - Define `containerVariants` using `cva("mx-auto px-4 sm:px-6 lg:px-8 py-8", { variants: { maxWidth: { narrow: "max-w-3xl", medium: "max-w-5xl", wide: "max-w-7xl", full: "" } }, defaultVariants: { maxWidth: "wide" } })`
   - Props: `{ children: ReactNode; maxWidth?: "narrow" | "medium" | "wide" | "full"; isLoading?: boolean; error?: Error | null; onRetry?: () => void; className?: string }`
   - If `isLoading`, render `<div className={cn(containerVariants({ maxWidth }), className)}><LoadingSpinner /></div>`
   - If `error`, render `<div className={cn(containerVariants({ maxWidth }), className)}><ErrorState error={error} onRetry={onRetry} /></div>`
   - Otherwise render `<div className={cn(containerVariants({ maxWidth }), className)}>{children}</div>`
   - Use `cn()` for className composition with optional className prop (allows calendar page to add `mr-[350px]` for pin sidebar)

2. Create `src/components/layout/page-header.tsx`:
   - Import Breadcrumb primitives from `@/components/ui/breadcrumb`
   - Import SidebarTrigger from `@/components/ui/sidebar`
   - Import Separator from `@/components/ui/separator` — install via `npx shadcn@latest add separator -y` if not present
   - Define `BreadcrumbItemType` interface: `{ label: string; href?: string }`
   - Props: `{ breadcrumbs?: BreadcrumbItemType[]; title: string; description?: string; actions?: ReactNode }`
   - Render a `<header>` with:
     - Top row: `<div className="flex items-center gap-2">` containing SidebarTrigger, a vertical Separator (className="mr-2 data-[orientation=vertical]:h-4"), then breadcrumbs (if provided)
     - Breadcrumbs: Map over items. For items with `href`, wrap in `<BreadcrumbLink asChild><Link to={item.href}>{item.label}</Link></BreadcrumbLink>`. Last item (or item without href) uses `<BreadcrumbPage>`. Add `<BreadcrumbSeparator />` between items.
     - Bottom row: `<div className="flex items-center justify-between mt-4">` with `<h1 className="text-2xl font-bold text-slate-900">{title}</h1>` and optional actions div
     - Optional description: `<p className="text-sm text-slate-600 mt-1">{description}</p>` below title when provided
   - Wrap the header in `<header className="border-b bg-white px-6 py-4">`

3. Create `src/components/layout/app-sidebar.tsx`:
   - Import Sidebar primitives from `@/components/ui/sidebar`
   - Import `Link` from `@tanstack/react-router`
   - Import `LayoutDashboard, Calendar, LogOut, ChevronsUpDown` from `lucide-react`
   - Import `AuthUser` type from `@/lib/auth`
   - Import `signOut` from `@/lib/auth`
   - Import `DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger` from `@/components/ui/dropdown-menu`
   - Import `useNavigate` from `@tanstack/react-router`
   - Props: `{ user: AuthUser }`
   - Define nav items array: `[{ title: "Dashboard", url: "/dashboard", icon: LayoutDashboard }, { title: "Calendar", url: "/calendar", icon: Calendar }]`
   - Render:
     ```
     <Sidebar collapsible="icon">
       <SidebarHeader>
         <div className="flex items-center gap-2 px-2 py-4">
           <span className="text-xl font-bold">Petra</span>
         </div>
       </SidebarHeader>
       <SidebarContent>
         <SidebarMenu>
           {navItems.map(item => (
             <SidebarMenuItem key={item.title}>
               <SidebarMenuButton asChild>
                 <Link to={item.url} activeProps={{ className: "bg-sidebar-accent text-sidebar-accent-foreground" }}>
                   <item.icon />
                   <span>{item.title}</span>
                 </Link>
               </SidebarMenuButton>
             </SidebarMenuItem>
           ))}
         </SidebarMenu>
       </SidebarContent>
       <SidebarFooter>
         <SidebarMenu>
           <SidebarMenuItem>
             <DropdownMenu>
               <DropdownMenuTrigger asChild>
                 <SidebarMenuButton>
                   <div className="flex h-6 w-6 items-center justify-center rounded-full bg-slate-900 text-[10px] font-medium text-white">
                     {initials}
                   </div>
                   <span>{user.display_name}</span>
                   <ChevronsUpDown className="ml-auto h-4 w-4" />
                 </SidebarMenuButton>
               </DropdownMenuTrigger>
               <DropdownMenuContent align="start" side="top" className="w-56">
                 <div className="px-2 py-1.5">
                   <p className="text-sm font-medium">{user.display_name}</p>
                   <p className="text-xs text-muted-foreground">{user.email}</p>
                 </div>
                 <DropdownMenuItem onClick={handleSignOut}>
                   <LogOut className="mr-2 h-4 w-4" />
                   Sign out
                 </DropdownMenuItem>
               </DropdownMenuContent>
             </DropdownMenu>
           </SidebarMenuItem>
         </SidebarMenu>
       </SidebarFooter>
       <SidebarRail />
     </Sidebar>
     ```
   - Compute `initials` from `user.display_name` the same way as current header.tsx: split by space, take first char of each, uppercase, slice to 2
   - `handleSignOut`: async function that calls `signOut()` then `navigate({ to: '/' })`
  </action>
  <verify>
    - Run `npx tsc --noEmit` — no type errors
    - Run `npm run build` — successful build
    - Confirm all 3 files export their named components
    - Confirm PageLayout accepts maxWidth variants
    - Confirm PageHeader renders breadcrumbs with Link components
    - Confirm AppSidebar uses DropdownMenu for user menu in footer
  </verify>
  <done>
    PageLayout with CVA container variants (narrow/medium/wide/full), PageHeader with breadcrumbs and SidebarTrigger, and AppSidebar with navigation items and user dropdown menu are all created and type-check successfully.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- `npm run build` succeeds
- All 7 new component files exist in correct locations
- shadcn/ui sidebar.tsx and breadcrumb.tsx installed in src/components/ui/
- LoadingSpinner has role="status" attribute
- ErrorState accepts error prop and optional onRetry
- PageLayout uses CVA with 4 maxWidth variants
- PageHeader renders SidebarTrigger and Breadcrumb components
- AppSidebar has Dashboard + Calendar nav items with signOut in footer
</verification>

<success_criteria>
All shared layout components are created, type-checked, and ready for consumption by Plans 02 and 03. No existing routes are modified yet — this plan is purely additive.
</success_criteria>

<output>
After completion, create `.planning/phases/09-consistent-ui-dashboard-layout/09-01-SUMMARY.md`
</output>
