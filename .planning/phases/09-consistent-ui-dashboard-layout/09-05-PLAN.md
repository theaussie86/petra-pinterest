---
phase: 09-consistent-ui-dashboard-layout
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/page-header.tsx
  - src/components/layout/page-layout.tsx
  - src/routes/_authed.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Main content area shifts right to accommodate sidebar width and never overlaps with the sidebar"
    - "User can collapse sidebar by clicking the SidebarTrigger button on every page"
    - "SidebarTrigger button is visible on all pages including Dashboard and Calendar (not just detail pages with breadcrumbs)"
    - "PageHeader uses compact vertical spacing, not excessive padding"
  artifacts:
    - path: "src/components/layout/page-header.tsx"
      provides: "PageHeader with always-visible SidebarTrigger and reduced padding"
      contains: "SidebarTrigger"
    - path: "src/routes/_authed.tsx"
      provides: "Authed layout with properly configured SidebarInset"
      contains: "SidebarInset"
  key_links:
    - from: "src/components/layout/page-header.tsx"
      to: "src/components/ui/sidebar.tsx"
      via: "SidebarTrigger import and rendering"
      pattern: "SidebarTrigger"
    - from: "src/routes/_authed.tsx"
      to: "src/components/ui/sidebar.tsx"
      via: "SidebarInset wrapping Outlet"
      pattern: "SidebarInset"
---

<objective>
Fix 4 layout gaps identified during Phase 9 verification: sidebar content overlap, non-functional collapse, missing trigger button on top-level pages, and excessive PageHeader padding.

Purpose: Close verified layout issues so sidebar navigation is fully functional and content is always accessible.
Output: Fixed page-header.tsx and _authed.tsx with working sidebar collapse/expand and compact header.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-consistent-ui-dashboard-layout/09-04-SUMMARY.md
@src/components/layout/page-header.tsx
@src/components/layout/page-layout.tsx
@src/components/layout/app-sidebar.tsx
@src/routes/_authed.tsx
@src/components/ui/sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix SidebarTrigger visibility and PageHeader padding</name>
  <files>src/components/layout/page-header.tsx</files>
  <action>
Fix two gaps in PageHeader:

**Gap 3 fix — SidebarTrigger always visible:**
The SidebarTrigger is currently nested inside the `{breadcrumbs && breadcrumbs.length > 0 && (...)}` conditional block, meaning it only renders on detail pages that pass breadcrumbs. Dashboard and Calendar pages call `<PageHeader title="Dashboard" />` without breadcrumbs, so the trigger button never appears.

Restructure PageHeader so that the SidebarTrigger + Separator always renders in a top row, regardless of whether breadcrumbs are provided. When breadcrumbs exist, render them after the separator in the same row. When no breadcrumbs, just show the trigger button alone.

The structure should be:
```
<header>
  <div className="flex items-center gap-2">
    <SidebarTrigger />
    <Separator orientation="vertical" className="mr-2 data-[orientation=vertical]:h-4" />
    {breadcrumbs && breadcrumbs.length > 0 && (
      <Breadcrumb>...</Breadcrumb>
    )}
  </div>
  <div className="flex items-center justify-between ...">
    <h1>...</h1>
    {actions}
  </div>
</header>
```

**Gap 4 fix — Reduce PageHeader padding:**
Change the header className from `"border-b bg-white px-6 py-4"` to `"border-b bg-white px-4 py-2"`. This reduces both horizontal and vertical padding.

Change the title container from `"flex items-center justify-between mt-4"` to `"flex items-center justify-between mt-2"`. This reduces the gap between the breadcrumb row and the title.

Change the title from `"text-2xl font-bold text-slate-900"` to `"text-lg font-semibold text-slate-900"`. This reduces the title size for a more compact header.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors.
Manually search for SidebarTrigger in page-header.tsx and confirm it is outside any breadcrumb conditional.
  </verify>
  <done>SidebarTrigger renders on every page regardless of breadcrumbs. PageHeader uses compact py-2 padding and text-lg title.</done>
</task>

<task type="auto">
  <name>Task 2: Fix sidebar content overlap and collapse behavior</name>
  <files>src/routes/_authed.tsx, src/components/layout/page-layout.tsx</files>
  <action>
Fix Gaps 1 and 2 — content overlapping with sidebar and collapse not working.

**Root cause analysis:**
The SidebarProvider creates a flex row container. The Sidebar component renders a spacer div with `w-[--sidebar-width]` (16rem) that should push the SidebarInset content to the right. The SidebarInset is `flex-1` which should fill remaining space. The sidebar's spacer div handles width transitions via `group-data-[collapsible=icon]:w-[--sidebar-width-icon]`.

The likely cause of content overlap is that the SidebarInset (or its children) is not constrained to the remaining flex space. In flexbox, children can overflow their flex-basis if their content is wider. The fix is to add `min-w-0` to SidebarInset and `overflow-auto` for scrolling.

**Fix in `src/routes/_authed.tsx`:**
Add `min-w-0 overflow-auto` className to the SidebarInset component. The `min-w-0` prevents the flex child from overflowing (default min-width in flex is `auto` which equals content width). The `overflow-auto` ensures content scrolls within the constrained area.

Change:
```tsx
<SidebarInset>
  <Outlet />
</SidebarInset>
```

To:
```tsx
<SidebarInset className="min-w-0 overflow-auto">
  <Outlet />
</SidebarInset>
```

This ensures the main content area respects the flex layout and never extends behind the sidebar, whether the sidebar is expanded (16rem) or collapsed (3rem icon mode).

**No changes needed to page-layout.tsx** — the issue is at the SidebarInset level, not the PageLayout level. PageLayout's `mx-auto` centering and max-width constraints work correctly once SidebarInset properly constrains its width.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors.
Run `npm run build` to confirm production build succeeds.
Verify that SidebarInset in _authed.tsx has className="min-w-0 overflow-auto".
  </verify>
  <done>SidebarInset constrains content width via min-w-0, preventing overlap. Content scrolls within the constrained area via overflow-auto. Sidebar collapse/expand changes the spacer width which shifts the content area accordingly.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. SidebarTrigger visible on Dashboard page (no breadcrumbs)
4. SidebarTrigger visible on detail pages (with breadcrumbs)
5. Clicking SidebarTrigger collapses sidebar to icon mode
6. Content area shifts to fill freed space when sidebar collapses
7. Content never hidden behind expanded sidebar
8. PageHeader is visually more compact (py-2, text-lg)
</verification>

<success_criteria>
All 4 layout gaps from 09-VERIFICATION.md are closed: content doesn't overlap sidebar, collapse/expand works, trigger button visible on all pages, header is compact. Build succeeds with no type errors.
</success_criteria>

<output>
After completion, create `.planning/phases/09-consistent-ui-dashboard-layout/09-05-SUMMARY.md`
</output>
